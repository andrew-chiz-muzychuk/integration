<?xml version="1.0" encoding="UTF-8"?>
<project xmlns:sf="antlib:com.salesforce" default="sf" basedir=".">
    <target name="Build">
        <echo>Continuous Integration Build</echo>
        <taskdef resource="net/sf/antcontrib/antlib.xml" />
        <property environment="env" />
        <echo>Branch: ${env.CIRCLE_BRANCH}</echo>
        <property file="build.${env.CIRCLE_BRANCH}.properties" />
      <echo>DeployCode</echo>
      <antcall target="DeployCode"/>
      <echo>updatePackage</echo>
      <antcall target="updatePackage"/>
    </target>
  <target name="DeployCode">
        <echo>Deploy Code CheckOnly in Org with username: ${sf.username}</echo>
    <sf:deploy username="${sf.username}" password="${sf.password}" serverurl="${sf.serverurl}" maxPoll="${sf.maxPoll}"
               logType="Detail" deployRoot="${user.dir}/src" checkOnly="false" testLevel="RunLocalTests"/>
    </target>
  <target name="updatePackage">
    <echo>Start Package update.</echo>
    <sf:deploy username="${sf.username}" password="${sf.password}" serverurl="${sf.serverurl}" maxPoll="${sf.maxPoll}"
               logType="Detail" deployRoot="${user.dir}/src" singlePackage="true"/>
    </target>
</project>